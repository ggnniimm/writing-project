#!/bin/bash
DIARY_FILE="git_diary.md"

while true; do
    echo "üì¢ ‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô Push ‡∏°‡∏±‡πâ‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö? (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏)"
    read -r MANUAL_LOG

    if [ -n "$MANUAL_LOG" ]; then
        echo "ü§î ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡πÑ‡∏´‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö?"
        echo "   1) ‚úçÔ∏è  Content & Research (‡∏á‡∏≤‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤/‡∏Ñ‡πâ‡∏ô‡∏Ñ‡∏ß‡πâ‡∏≤)"
        echo "   2) üîß System & Workflow (‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö/‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤)"
        read -p "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (1/2): " CAT_CHOICE

        CATEGORY="system"
        if [ "$CAT_CHOICE" == "1" ]; then
            CATEGORY="content"
        fi
        
        # Calculate changed files details
        CHANGED_FILES=$(git diff --name-status HEAD | sed 's/^M[[:space:]]*/    -   üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: /;s/^A[[:space:]]*/    -   ‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà: /;s/^D[[:space:]]*/    -   üóëÔ∏è ‡∏•‡∏ö: /')

        # Call Python script
        python3 update_diary.py "$CATEGORY" "$MANUAL_LOG" "$CHANGED_FILES"

        # Commit ALL files automatically
        git add .
        git commit -m "$MANUAL_LOG"
        echo "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Diary ‡πÅ‡∏•‡∏∞ Commit (‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏á‡∏≤‡∏ô) ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"
        break
    else
        echo "‚ùå ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á"
    fi
done

# 3. ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô GitHub
echo "üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô GitHub..."
git push
