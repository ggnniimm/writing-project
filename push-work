#!/bin/bash
DIARY_FILE="git_diary.md"

# 1. Stage all changes first
git add .

# 2. Get Smart Suggestion
SUGGESTION=$(python3 update_diary.py --suggest)
# Suggestion format: category|message|details (newline separated)
IFS='|' read -r AUTO_CAT AUTO_MSG AUTO_DETAILS <<< "$SUGGESTION"

echo "ðŸ¤– à¸£à¸°à¸šà¸šà¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“..."
echo "---------------------------------------------------"
echo "ðŸ“‚ à¸«à¸¡à¸§à¸”à¸‡à¸²à¸™: $AUTO_CAT"
echo "ðŸ“ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡: $AUTO_MSG"
echo "---------------------------------------------------"
echo "ðŸ’¡ à¸à¸” [Enter] à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸™à¸µà¹‰ à¸«à¸£à¸·à¸­à¸žà¸´à¸¡à¸žà¹Œà¹ƒà¸«à¸¡à¹ˆà¹€à¸žà¸·à¹ˆà¸­à¹à¸à¹‰à¹„à¸‚"
read -p "ðŸ‘‰ Your Log: " USER_LOG

if [ -z "$USER_LOG" ]; then
    MANUAL_LOG="$AUTO_MSG"
    CATEGORY="$AUTO_CAT"
    DETAILS="$AUTO_DETAILS"
else
    MANUAL_LOG="$USER_LOG"
    # If user types manual log, we ask for category just to be safe, or default to auto?
    # Let's keep it simple: If manual, assume user wants full control OR just use auto category.
    # To be safe, let's use the Auto Category unless user wants to change (too complex for now).
    # We'll use Auto Category for simplicity.
    CATEGORY="$AUTO_CAT"
    DETAILS="$AUTO_DETAILS" # Keep details even if message changes
fi

# Call Python script to write to diary
python3 update_diary.py "$CATEGORY" "$MANUAL_LOG" "$DETAILS"

# Commit
git commit -m "$MANUAL_LOG"
echo "âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¸¥à¸‡ Diary à¹à¸¥à¸° Commit (à¸£à¸§à¸¡à¹„à¸Ÿà¸¥à¹Œà¸‡à¸²à¸™) à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢"

# 3. à¸ªà¹ˆà¸‡à¸‡à¸²à¸™à¸‚à¸¶à¹‰à¸™ GitHub
echo "ðŸš€ à¸à¸³à¸¥à¸±à¸‡à¸ªà¹ˆà¸‡à¸‡à¸²à¸™à¸‚à¸¶à¹‰à¸™ GitHub..."
git push
